<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Futures Risk Calculator</title>
    <style>
        :root {
            --primary: #2563eb;
            --danger: #dc2626;
            --warning: #d97706;
            --success: #059669;
            --dark: #0f172a;
            --light: #f8fafc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #60a5fa, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .card h2 {
            color: #60a5fa;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #cbd5e1;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #334155;
            border-radius: 8px;
            background: #1e293b;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .tp-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .tp-row {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: end;
        }
        
        .btn-add-tp {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        
        .btn-remove-tp {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .percentage-display {
            color: #60a5fa;
            font-weight: 600;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        .btn-calculate {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, var(--primary), #1d4ed8);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #334155;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: #cbd5e1;
        }
        
        .result-value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .tp-result {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            border-left: 3px solid var(--success);
        }
        
        .risk-meter {
            height: 20px;
            background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .risk-indicator {
            position: absolute;
            top: -5px;
            width: 4px;
            height: 30px;
            background: white;
            transform: translateX(-50%);
            transition: left 0.5s ease;
        }
        
        .safety-checks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .check-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .check-valid {
            background: var(--success);
        }
        
        .check-invalid {
            background: var(--danger);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ Crypto Futures Risk Calculator</h1>
            <p>Professional Risk Management for Trading</p>
            <p>Created BY@ITSRYZENN</p>
        </div>
        
        <div class="calculator-grid">
            <!-- Input Section -->
            <div class="card">
                <h2>ðŸ“Š Trade Parameters</h2>
                
                <div class="input-group">
                    <label for="balance">Account Balance (USDT)</label>
                    <input type="number" id="balance" value="110" min="1">
                </div>
                
                <div class="input-group">
                    <label for="riskPercent">Risk Percentage (%)</label>
                    <input type="number" id="riskPercent" value="2" min="0.1" max="10" step="0.1">
                </div>
                
                <div class="input-group">
                    <label for="entryPrice">Entry Price (USDT)</label>
                    <input type="number" id="entryPrice" value="39.7" min="0.0001" step="0.0001">
                </div>
                
                <div class="input-group">
                    <label for="stopLoss">Stop Loss Price (USDT)</label>
                    <input type="number" id="stopLoss" value="37.38" min="0.0001" step="0.0001">
                    <div class="percentage-display" id="dropPercentage">Drop: 5.84%</div>
                </div>
                
                <div class="input-group">
                    <label>Take Profit Targets</label>
                    <div class="tp-section" id="tpSection">
                        <div class="tp-row">
                            <div>
                                <label>TP 1 Price</label>
                                <input type="number" class="tp-price" value="41" min="0.0001" step="0.0001">
                                <div class="percentage-display tp-gain">Gain: 3.27%</div>
                            </div>
                            <div>
                                <label>TP 1 % Size</label>
                                <input type="number" class="tp-percent" value="30" min="0" max="100" step="5">
                            </div>
                            <div>
                                <button class="btn-remove-tp" onclick="removeTP(1)">Remove</button>
                            </div>
                        </div>
                        
                        <div class="tp-row">
                            <div>
                                <label>TP 2 Price</label>
                                <input type="number" class="tp-price" value="42.5" min="0.0001" step="0.0001">
                                <div class="percentage-display tp-gain">Gain: 7.05%</div>
                            </div>
                            <div>
                                <label>TP 2 % Size</label>
                                <input type="number" class="tp-percent" value="40" min="0" max="100" step="5">
                            </div>
                            <div>
                                <button type="button" class="btn-remove-tp" onclick="removeTP(this)">Remove</button>
                            </div>
                        </div>
                        
                        <div class="tp-row">
                            <div>
                                <label>TP 3 Price</label>
                                <input type="number" class="tp-price" value="45" min="0.0001" step="0.0001">
                                <div class="percentage-display tp-gain">Gain: 13.35%</div>
                            </div>
                            <div>
                                <label>TP 3 % Size</label>
                                <input type="number" class="tp-percent" value="30" min="0" max="100" step="5">
                            </div>
                            <div>
                                <button class="btn-remove-tp" onclick="removeTP(3)">Remove</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn-add-tp" onclick="addTP()">+ Add Take Profit</button>
                </div>
                
                <div class="input-group">
                    <label for="leverage">Leverage</label>
                    <input type="number" id="leverage" value="10" min="1" max="100">
                </div>
                
                <div class="input-group">
                    <label for="positionType">Position Type</label>
                    <select id="positionType">
                        <option value="long">Long</option>
                        <option value="short">Short</option>
                    </select>
                </div>
                
                <button class="btn-calculate" onclick="calculateRisk()">ðŸŽ¯ Calculate Risk</button>
            </div>
            
            <!-- Results Section -->
            <div class="card">
                <h2>ðŸ“ˆ Results & Analysis</h2>
                
                <div class="result-item">
                    <span class="result-label">Position Size:</span>
                    <span class="result-value" id="positionSize">-</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Risk Amount:</span>
                    <span class="result-value" id="riskAmount">-</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Quantity:</span>
                    <span class="result-value" id="quantity">-</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Weighted RR Ratio:</span>
                    <span class="result-value" id="rrRatio">-</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Liquidation Price:</span>
                    <span class="result-value" id="liquidationPrice">-</span>
                </div>
                
                <h3 style="margin-top: 20px; color: #60a5fa;">Take Profit Breakdown</h3>
                <div id="tpResults">
                    <!-- TP results will be populated here -->
                </div>
                
                <h3 style="margin-top: 20px;">Risk Meter</h3>
                <div class="risk-meter">
                    <div class="risk-indicator" id="riskIndicator"></div>
                </div>
                <div style="display: flex; justify-content: space-between; color: #cbd5e1; font-size: 0.9rem;">
                    <span>Safe</span>
                    <span>Medium</span>
                    <span>High Risk</span>
                </div>
                
                <h3 style="margin-top: 30px;">Safety Checks</h3>
                <div class="safety-checks" id="safetyChecks">
                    <!-- Safety checks will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
    let tpCount = 3;

    // Update percentage displays
    function updatePercentages() {
        const entry = parseFloat(document.getElementById('entryPrice').value) || 0;
        const sl = parseFloat(document.getElementById('stopLoss').value) || 0;
        
        if (entry > 0 && sl > 0) {
            const dropPct = Math.abs(entry - sl) / entry * 100;
            document.getElementById('dropPercentage').textContent = `Drop: ${dropPct.toFixed(2)}%`;
        }
        
        // Update TP gain percentages
        document.querySelectorAll('.tp-row').forEach((row, index) => {
            const tpPriceInput = row.querySelector('.tp-price');
            const tpPrice = parseFloat(tpPriceInput.value) || 0;
            if (entry > 0 && tpPrice > 0) {
                const gainPct = Math.abs(tpPrice - entry) / entry * 100;
                const gainDisplay = row.querySelector('.tp-gain');
                if (gainDisplay) {
                    gainDisplay.textContent = `Gain: ${gainPct.toFixed(2)}%`;
                }
            }
        });
    }

    // Add new TP row
    function addTP() {
        tpCount++;
        const tpSection = document.getElementById('tpSection');
        const newTP = document.createElement('div');
        newTP.className = 'tp-row';
        newTP.setAttribute('data-tp-id', tpCount);
        newTP.innerHTML = `
            <div>
                <label>TP ${tpCount} Price</label>
                <input type="number" class="tp-price" value="${40 + tpCount}" min="0.0001" step="0.0001">
                <div class="percentage-display tp-gain">Gain: 0%</div>
            </div>
            <div>
                <label>TP ${tpCount} % Size</label>
                <input type="number" class="tp-percent" value="20" min="0" max="100" step="5">
            </div>
            <div>
                <button type="button" class="btn-remove-tp" onclick="removeTP(${tpCount})">Remove</button>
            </div>
        `;
        tpSection.appendChild(newTP);
        
        // Add event listeners to new inputs
        const newInputs = newTP.querySelectorAll('.tp-price, .tp-percent');
        newInputs.forEach(input => {
            input.addEventListener('input', function() {
                updatePercentages();
                calculateRisk();
            });
        });
        
        updatePercentages();
        calculateRisk();
    }

    // Remove TP row - FIXED VERSION
    function removeTP(id) {
        if (tpCount > 1) {
            const tpRows = document.querySelectorAll('.tp-row');
            const tpRowToRemove = Array.from(tpRows).find(row => 
                parseInt(row.getAttribute('data-tp-id')) === id
            );
            
            if (tpRowToRemove) {
                tpRowToRemove.remove();
                tpCount--;
                updateTPLabels();
                updatePercentages();
                calculateRisk();
            }
        }
    }

    // Update TP labels after removal - FIXED VERSION
    function updateTPLabels() {
        const tpRows = document.querySelectorAll('.tp-row');
        tpRows.forEach((row, index) => {
            const newId = index + 1;
            row.setAttribute('data-tp-id', newId);
            const labels = row.querySelectorAll('label');
            const button = row.querySelector('.btn-remove-tp');
            const priceInput = row.querySelector('.tp-price');
            const percentInput = row.querySelector('.tp-percent');
            
            if (labels[0]) labels[0].textContent = `TP ${newId} Price`;
            if (labels[1]) labels[1].textContent = `TP ${newId} % Size`;
            if (button) button.setAttribute('onclick', `removeTP(${newId})`);
        });
    }

    // Initialize TP rows with data attributes
    function initializeTPRows() {
        document.querySelectorAll('.tp-row').forEach((row, index) => {
            row.setAttribute('data-tp-id', index + 1);
        });
    }

    // Input field listeners
    const inputs = ['balance', 'riskPercent', 'entryPrice', 'stopLoss', 'leverage'];
    inputs.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('input', function() {
                updatePercentages();
                calculateRisk();
            });
        }
    });

    // TP input listeners
    document.addEventListener('input', function(e) {
        if (e.target.classList.contains('tp-price') || e.target.classList.contains('tp-percent')) {
            updatePercentages();
            calculateRisk();
        }
    });

    // Position type listener
    document.getElementById('positionType').addEventListener('change', calculateRisk);

    function calculateRisk() {
        // Get input values
        const balance = parseFloat(document.getElementById('balance').value) || 0;
        const riskPercent = parseFloat(document.getElementById('riskPercent').value) || 0;
        const entryPrice = parseFloat(document.getElementById('entryPrice').value) || 0;
        const stopLoss = parseFloat(document.getElementById('stopLoss').value) || 0;
        const leverage = parseFloat(document.getElementById('leverage').value) || 1;
        const positionType = document.getElementById('positionType').value;
        
        // Get TP data
        const tpData = [];
        let totalPercent = 0;
        
        document.querySelectorAll('.tp-row').forEach(row => {
            const priceInput = row.querySelector('.tp-price');
            const percentInput = row.querySelector('.tp-percent');
            const price = parseFloat(priceInput?.value) || 0;
            const percent = parseFloat(percentInput?.value) || 0;
            
            if (price > 0 && percent > 0) {
                tpData.push({ price, percent });
                totalPercent += percent;
            }
        });

        // Adjust percentages if total != 100%
        if (totalPercent !== 100 && totalPercent > 0 && tpData.length > 0) {
            tpData.forEach(tp => {
                tp.percent = (tp.percent / totalPercent) * 100;
            });
            totalPercent = 100;
        }

        // Step 1: Calculate Risk Amount
        const riskAmount = balance * (riskPercent / 100);
        
        // Step 2: Calculate Percentage Drop
        const dropPercentage = entryPrice > 0 ? Math.abs(entryPrice - stopLoss) / entryPrice * 100 : 0;
        
        // Step 3: Calculate Position Size (CORRECTED FORMULA)
        const positionSize = dropPercentage > 0 ? (riskAmount * 100) / dropPercentage / leverage : 0;
        
        // Step 4: Calculate Quantity
        const quantity = entryPrice > 0 ? positionSize / entryPrice : 0;
        
        // Step 5: Calculate Weighted RR Ratio
        let totalWeightedRR = 0;
        const riskDistance = Math.abs(entryPrice - stopLoss);
        
        if (riskDistance > 0) {
            tpData.forEach(tp => {
                const rewardDistance = Math.abs(tp.price - entryPrice);
                const rrRatio = rewardDistance / riskDistance;
                totalWeightedRR += rrRatio * (tp.percent / 100);
            });
        }
        
        const weightedRR = totalWeightedRR > 0 ? totalWeightedRR.toFixed(2) : "0";
        
        // Step 6: Calculate Liquidation Price
        let liquidationPrice = 0;
        if (entryPrice > 0 && leverage > 0) {
            if (positionType === 'long') {
                liquidationPrice = entryPrice * (1 - (1 / leverage) + 0.005);
            } else {
                liquidationPrice = entryPrice * (1 + (1 / leverage) - 0.005);
            }
        }
        
        // Update results
        document.getElementById('positionSize').textContent = `$${positionSize.toFixed(2)} USDT`;
        document.getElementById('riskAmount').textContent = `$${riskAmount.toFixed(2)} USDT`;
        document.getElementById('quantity').textContent = `${quantity.toFixed(3)} coins`;
        document.getElementById('rrRatio').textContent = `1:${weightedRR}`;
        document.getElementById('liquidationPrice').textContent = `$${liquidationPrice.toFixed(2)} USDT`;
        
        // Update TP Results
        const tpResults = document.getElementById('tpResults');
        tpResults.innerHTML = '';
        
        if (tpData.length > 0) {
            tpData.forEach((tp, index) => {
                const rewardDistance = Math.abs(tp.price - entryPrice);
                const rrRatio = riskDistance > 0 ? (rewardDistance / riskDistance).toFixed(2) : "0";
                const tpSize = (tp.percent / 100) * quantity;
                const profit = tpSize * rewardDistance;
                
                const tpResult = document.createElement('div');
                tpResult.className = 'tp-result';
                tpResult.innerHTML = `
                    <strong>TP ${index + 1}: $${tp.price.toFixed(2)}</strong><br>
                    Size: ${Math.round(tp.percent)}% | RR: 1:${rrRatio}<br>
                    Profit: $${profit.toFixed(2)} | Coins: ${tpSize.toFixed(3)}
                `;
                tpResults.appendChild(tpResult);
            });
        } else {
            tpResults.innerHTML = '<div class="tp-result">No take profit targets set</div>';
        }
        
        // Update risk meter
        updateRiskMeter(riskPercent);
        
        // Update safety checks
        updateSafetyChecks({
            riskPercent,
            rrRatio: parseFloat(weightedRR) || 0,
            leverage,
            liquidationPrice,
            entryPrice,
            stopLoss,
            positionType,
            dropPercentage,
            totalPercent: tpData.reduce((sum, tp) => sum + tp.percent, 0)
        });
    }
    
    function updateRiskMeter(riskPct) {
        const indicator = document.getElementById('riskIndicator');
        if (!indicator) return;
        
        let position;
        
        if (riskPct <= 2) {
            position = (riskPct / 2) * 33;
        } else if (riskPct <= 5) {
            position = 33 + ((riskPct - 2) / 3) * 33;
        } else {
            position = 66 + (Math.min(riskPct - 5, 5) / 5) * 34;
        }
        
        indicator.style.left = `${Math.min(position, 100)}%`;
    }
    
    function updateSafetyChecks(params) {
        const checksContainer = document.getElementById('safetyChecks');
        if (!checksContainer) return;
        
        const checks = [
            {
                name: 'Risk per Trade â‰¤ 2%',
                valid: params.riskPercent <= 2,
                message: params.riskPercent <= 2 ? 'Good risk management' : 'Risk too high'
            },
            {
                name: 'RR Ratio â‰¥ 1.5',
                valid: params.rrRatio >= 1.5,
                message: params.rrRatio >= 1.5 ? 'Good reward potential' : 'Reward too low'
            },
            {
                name: 'Leverage Safe',
                valid: params.leverage <= 10,
                message: params.leverage <= 10 ? 'Leverage acceptable' : 'High leverage risk'
            },
            {
                name: 'TP Allocation = 100%',
                valid: Math.abs(params.totalPercent - 100) < 1,
                message: Math.abs(params.totalPercent - 100) < 1 ? 'Proper allocation' : 'Adjust TP sizes'
            }
        ];
        
        checksContainer.innerHTML = checks.map(check => `
            <div class="check-item">
                <div class="check-icon ${check.valid ? 'check-valid' : 'check-invalid'}">
                    ${check.valid ? 'âœ“' : '!'}
                </div>
                <div>
                    <div>${check.name}</div>
                    <div style="font-size: 0.8rem; color: #94a3b8;">${check.message}</div>
                </div>
            </div>
        `).join('');
    }
    
    // Initialize everything when page loads
    document.addEventListener('DOMContentLoaded', function() {
        initializeTPRows();
        updatePercentages();
        calculateRisk();
    });

    // Also initialize if DOM is already loaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            initializeTPRows();
            updatePercentages();
            calculateRisk();
        });
    } else {
        initializeTPRows();
        updatePercentages();
        calculateRisk();
    }
</script>
</body>
</html>
